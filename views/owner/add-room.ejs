<%- include('../partials/header') %>

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card hover-shadow">
                <div class="card-header bg-primary text-white">
                    <h3 class="text-center mb-0"><i class="fas fa-plus-circle me-2"></i>Ajouter une nouvelle salle</h3>
                </div>
                <div class="card-body">
                    <form action="/owner/add-room" method="POST" enctype="multipart/form-data">
                        <!-- Informations de base -->
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="name" class="form-label">Nom de la salle</label>
                                <input type="text" class="form-control" id="name" name="name" required placeholder="Ex: Salle de réunion principale">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="capacity" class="form-label">Capacité (personnes)</label>
                                <input type="number" class="form-control" id="capacity" name="capacity" min="1" required placeholder="Ex: 50">
                            </div>
                        </div>

                        <!-- Description -->
                        <div class="mb-3">
                            <label for="description" class="form-label">Description</label>
                            <textarea class="form-control" id="description" name="description" rows="3" required placeholder="Décrivez les caractéristiques de la salle, ses équipements principaux, etc."></textarea>
                        </div>

                        <!-- Localisation -->
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="location" class="form-label">Adresse / Lieu</label>
                                <input type="text" class="form-control" id="location" name="location" required placeholder="Ex: Centre-ville, Alger">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="wilaya" class="form-label">Wilaya</label>
                                <input type="text" class="form-control" id="wilaya" name="wilaya" required placeholder="Ex: Alger">
                            </div>
                        </div>

                        <!-- Coordonnées GPS -->
                        <div class="mb-3">
                            <label class="form-label">Localisation sur la carte</label>
                            <p class="text-muted small">Cliquez sur la carte pour définir la position exacte de votre salle, ou saisissez manuellement les coordonnées</p>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="lat" class="form-label">Latitude</label>
                                    <input type="text" class="form-control" id="lat" name="lat" value="36.7538" placeholder="Ex: 36.7538" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="lng" class="form-label">Longitude</label>
                                    <input type="number" step="0.000001" class="form-control" id="lng" name="lng" value="3.0588" placeholder="Ex: 3.0588" required>
                                </div>
                            </div>
                            <!-- Petite carte pour sélectionner la position -->
                            <div id="location-map" style="height: 300px; border: 1px solid #ddd; border-radius: 8px;"></div>
                        </div>

                        <!-- Prix et image -->
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="price" class="form-label">Prix par jour (DA)</label>
                                <input type="number" class="form-control" id="price" name="price" min="0" required placeholder="Ex: 5000">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="image" class="form-label">Image de la salle</label>
                                <input type="file" class="form-control" id="image" name="image" accept="image/*" required>
                                <div class="form-text">Formats acceptés: JPG, PNG, GIF. Taille max: 5MB</div>
                            </div>
                        </div>

                        <!-- Équipements -->
                        <div class="mb-3">
                            <label class="form-label">Équipements disponibles</label>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" name="equipment" value="wifi" id="wifi">
                                        <label class="form-check-label" for="wifi">
                                            WiFi haut débit
                                        </label>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" name="equipment" value="projector" id="projector">
                                        <label class="form-check-label" for="projector">
                                            Vidéoprojecteur
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" name="equipment" value="sound" id="sound">
                                        <label class="form-check-label" for="sound">
                                            Système audio
                                        </label>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" name="equipment" value="whiteboard" id="whiteboard">
                                        <label class="form-check-label" for="whiteboard">
                                            Tableau blanc
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Bouton de soumission -->
                        <div class="text-center mt-4">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fas fa-save me-2"></i>Ajouter la salle
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.js"></script>
<script>
// Initialisation de la carte pour la sélection de localisation
const locationMap = L.map('location-map').setView([36.7538, 3.0588], 10); // Centré sur Alger

// Tile layer
L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
    attribution: '© OpenStreetMap contributors © CARTO',
    maxZoom: 19
}).addTo(locationMap);

// Marqueur pour la position sélectionnée
let selectedMarker = L.marker([36.7538, 3.0588]).addTo(locationMap)
    .bindPopup('Position par défaut<br>Lat: 36.7538<br>Lng: 3.0588')
    .openPopup();

// Gestionnaire de clic sur la carte
locationMap.on('click', function(e) {
    const lat = e.latlng.lat.toFixed(6);
    const lng = e.latlng.lng.toFixed(6);

    // Mettre à jour les champs
    document.getElementById('lat').value = lat;
    document.getElementById('lng').value = lng;

    // Déplacer le marqueur
    selectedMarker.setLatLng([lat, lng]);
    selectedMarker.bindPopup('Position sélectionnée<br>Lat: ' + lat + '<br>Lng: ' + lng).openPopup();
});

// Synchronisation des champs vers la carte
document.getElementById('lat').addEventListener('input', updateMapFromFields);
document.getElementById('lng').addEventListener('input', updateMapFromFields);

function updateMapFromFields() {
    const lat = parseFloat(document.getElementById('lat').value);
    const lng = parseFloat(document.getElementById('lng').value);
    
    if (!isNaN(lat) && !isNaN(lng)) {
        selectedMarker.setLatLng([lat, lng]);
        locationMap.setView([lat, lng], 15);
        selectedMarker.bindPopup('Position personnalisée<br>Lat: ' + lat + '<br>Lng: ' + lng).openPopup();
    }
}

// Géolocalisation automatique si disponible
if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(function(position) {
        const lat = position.coords.latitude;
        const lng = position.coords.longitude;
        
        // Mettre à jour les champs et la carte
        document.getElementById('lat').value = lat.toFixed(6);
        document.getElementById('lng').value = lng.toFixed(6);
        selectedMarker.setLatLng([lat, lng]);
        locationMap.setView([lat, lng], 15);
        selectedMarker.bindPopup('Votre position<br>Lat: ' + lat.toFixed(6) + '<br>Lng: ' + lng.toFixed(6)).openPopup();
    });
}
</script>

<%- include('../partials/footer') %>
